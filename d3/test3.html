<!DOCTYPE html>

<style>
body {
  text-align: center;
}

h1 {
  margin-top: 0;
}

svg {
/*  margin-top: 32px; */
  border: 1px solid #aaa;
}
</style>

<!-- Add a svg area, empty -->
<svg id='dataviz_area' height=400 width=800></svg>

<!-- Load d3.js -->
<script src='https://d3js.org/d3.v4.js'></script>

<!-- For slider -->
<script src="https://unpkg.com/d3-simple-slider"></script>


<script type="module">

//import { data } from "./data.js";
//console.log(data);

let data = [  
    { seq:  1, name: 'PACE 111B',   credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq:  2, name: 'LIBS 150',    credits: 1, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq:  3, name: 'WRTG 111',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq:  4, name: 'WRTG 112',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq:  5, name: 'NUTR 100',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq:  6, name: 'BMGT 110',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq:  7, name: 'SPCH 100',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq:  8, name: 'STAT 200',    credits: 3, color: 'red',    textcolor: 'white', prerequisite: '' },
    { seq:  9, name: 'IFSM 300',    credits: 3, color: 'red',    textcolor: 'white', prerequisite: '' },
    { seq: 10, name: 'ACCT 220',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq: 11, name: 'HUMN 100',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq: 12, name: 'BIOL 103',    credits: 4, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq: 13, name: 'ECON 201',    credits: 3, color: 'red',    textcolor: 'white', prerequisite: '' },
    { seq: 14, name: 'ARTH 334',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq: 15, name: 'ELECTIVE 1',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 16, name: 'ECON 203',    credits: 3, color: 'red',    textcolor: 'white', prerequisite: '' },
    { seq: 17, name: 'ACCT 221',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: 'ACCT 220' },  
    { seq: 18, name: 'ELECTIVE 2',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 19, name: 'BMGT 364',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq: 20, name: 'ELECTIVE 3',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 21, name: 'BMGT 365',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: 'BMGT 364' },
    { seq: 22, name: 'ELECTIVE 4',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 23, name: 'MRKT 310',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq: 24, name: 'WRTG 394',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: 'WRTG 112' },
    { seq: 25, name: 'ELECTIVE 5',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 26, name: 'BMGT 380',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq: 27, name: 'ELECTIVE 6',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 28, name: 'ELECTIVE 7',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 29, name: 'HRMN 300',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq: 30, name: 'ELECTIVE 8',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 31, name: 'ELECTIVE 9',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 32, name: 'FINC 330',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: 'ACCT 221 & STAT 200' },  
    { seq: 33, name: 'ELECTIVE 10', credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 34, name: 'ELECTIVE 11', credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 35, name: 'BMGT 496',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq: 36, name: 'ELECTIVE 12', credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 37, name: 'ELECTIVE 13', credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 38, name: 'ELECTIVE 14', credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 39, name: 'ELECTIVE 15', credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 40, name: 'BMGT 495',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: 'BMGT 365 & MRKT 310 & FINC 330' },
    { seq: 41, name: 'CAPSTONE',    credits: 1, color: 'yellow', textcolor: 'black', prerequisite: 'FINC 330' }
    ];

let transfer_data = [  
    { seq:  1, name: 'PACE 111B',   credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq:  2, name: 'LIBS 150',    credits: 1, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq:  3, name: 'WRTG 111',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq:  4, name: 'WRTG 112',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq:  5, name: 'NUTR 100',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq:  6, name: 'BMGT 110',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq:  7, name: 'SPCH 100',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq:  8, name: 'STAT 200',    credits: 3, color: 'red',    textcolor: 'white', prerequisite: '' },
    { seq:  9, name: 'IFSM 300',    credits: 3, color: 'red',    textcolor: 'white', prerequisite: '' },
    { seq: 10, name: 'ACCT 220',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq: 11, name: 'HUMN 100',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq: 12, name: 'BIOL 103',    credits: 4, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq: 13, name: 'ECON 201',    credits: 3, color: 'red',    textcolor: 'white', prerequisite: '' },
    { seq: 14, name: 'ARTH 334',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: '' },
    { seq: 15, name: 'ELECTIVE 1',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 16, name: 'ECON 203',    credits: 3, color: 'red',    textcolor: 'white', prerequisite: '' },
    { seq: 17, name: 'ACCT 221',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: 'ACCT 220' },  
    { seq: 18, name: 'ELECTIVE 2',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 19, name: 'BMGT 364',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq: 20, name: 'ELECTIVE 3',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 21, name: 'BMGT 365',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: 'BMGT 364' },
    { seq: 22, name: 'ELECTIVE 4',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 23, name: 'MRKT 310',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq: 24, name: 'WRTG 394',    credits: 3, color: 'green',  textcolor: 'white', prerequisite: 'WRTG 112' },
    { seq: 25, name: 'ELECTIVE 5',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 26, name: 'BMGT 380',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq: 27, name: 'ELECTIVE 6',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 28, name: 'ELECTIVE 7',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 29, name: 'HRMN 300',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq: 30, name: 'ELECTIVE 8',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 31, name: 'ELECTIVE 9',  credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 32, name: 'FINC 330',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: 'ACCT 221 & STAT 200' },  
    { seq: 33, name: 'ELECTIVE 10', credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 34, name: 'ELECTIVE 11', credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 35, name: 'BMGT 496',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: '' },
    { seq: 36, name: 'ELECTIVE 12', credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 37, name: 'ELECTIVE 13', credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 38, name: 'ELECTIVE 14', credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 39, name: 'ELECTIVE 15', credits: 3, color: 'yellow', textcolor: 'black', prerequisite: '' },
    { seq: 40, name: 'BMGT 495',    credits: 3, color: 'blue',   textcolor: 'white', prerequisite: 'BMGT 365 & MRKT 310 & FINC 330' },
    { seq: 41, name: 'CAPSTONE',    credits: 1, color: 'yellow', textcolor: 'black', prerequisite: 'FINC 330' }
    ];

// Select the body
var body = d3.select("body");

// Append a new h1 to the body
var h1 = body.append("h1");

// Set the text of the h1
h1.text("Student Curriculum Explorer");

// Dropdown Menu Stuff from Here

// Select Degree
var chosenDegree = "SE";
var degreeList = [
  [0, "SE", "SELECT DEGREE"],
  [1, "AS", "Associate"],
  [2, "BS", "Bachelor's"],
  [3, "MS", "Master's"],
  [4, "DC", "Doctorate"],
  [5, "UC", "Undergraduate Certificate"],
  [6, "GC", "Graduate Certificate"]
];

// Select Area of Study
var chosenStudy = "SE";
var studyList = [
  [0, "SE", "SELECT AREA OF STUDY"],
  [1, 'BM', 'Business & Management'],
  [2, 'CS', 'Cybersecurity'],
  [3, 'DA', 'Data Analytics'],
  [4, 'ET', 'Education & Teaching'],
  [5, 'HS', 'Healthcare & Science'],
  [6, 'LA', 'Liberal Arts & Communications'],
  [7, 'PS', 'Public Safety'],
  [8, 'IT', 'IT & Computer Science']
];

// Select Major
var chosenMajor = "SE";
var majorList = [
  [0, "SE", "SELECT MAJOR"],
  [1, 'AC', 'Accounting'],
  [2, 'BA', 'Business Administration'],
  [3, 'FI', 'Finance'],
  [4, 'HR', 'Human Resource Management'],
  [5, 'MS', 'Management Studies'],
  [6, 'MK', 'Marketing']
];

// Create a container for the dropdowns
var container = body.append("div")
  .style("display", "flex")
  .style("justify-content", "space-between")
  .style("align-items", "center") // Vertically center the menus
  .style("gap", "1px") // Add a space of 2px between the menus
  .style("width", "800px"); // Make sure to include the unit (px) for the width

// Degree dropdown
var degreeDropdown = container.append("div");
//degreeDropdown.append("label").text("Degree");

var degreeSelect = degreeDropdown.append("select")
  .attr('id', 'degreeDropDownId');
var degreeOptions = degreeSelect.selectAll('option')
  .data(degreeList)
  .enter()
  .append('option')
  .attr('value', (d) => d[1])
  .text((d) => d[2]);
degreeOptions.property("selected", function(d) {
  return d[1] === chosenDegree;
});

// Area of Study dropdown
var studyDropdown = container.append("div");
//studyDropdown.append("label").text("Area of Study");
var studySelect = studyDropdown.append("select")
  .attr('id', 'studyDropDownId');
var studyOptions = studySelect.selectAll('option')
  .data(studyList)
  .enter()
  .append('option')
  .attr('value', (d) => d[1])
  .text((d) => d[2]);
studyOptions.property("selected", function(d) {
  return d[1] === chosenStudy;
});

// Major dropdown
var majorDropdown = container.append("div");
//majorDropdown.append("label").text("Major");
var majorSelect = majorDropdown.append("select")
  .attr('id', 'majorDropDownId');
var majorOptions = majorSelect.selectAll('option')
  .data(majorList)
  .enter()
  .append('option')
  .attr('value', (d) => d[1])
  .text((d) => d[2]);
majorOptions.property("selected", function(d) {
  return d[1] === chosenMajor;
});

// End of Dropdowns


// Define your SVG
var svg = d3.select('#dataviz_area');

// Define the zoomable group
var zoomable = svg.append("g");

// Define the zoom behavior
var zoom = d3.zoom()
  .on("zoom", function() {
    zoomable.attr("transform", d3.event.transform);
  });

// Apply the zoom behavior to your SVG
svg.call(zoom);

var screen_width = 800;
var box_width = 110;
var box_height = 40;
var text_x_offset = 10; 
var text_y_offset = 25;

//function drawRectangle(rect) {
//  var g = zoomable.append("g");
//  
//  g.append("rect")
//    .attr("x", rect.x)
//    .attr("y", rect.y)
//    .attr("width", box_width)
//    .attr("height", box_height)
//    .style("fill", rect.color)
//    .classed("movable", true); // Add the "movable" class
//  
//  g.append("text")
//    .attr("x", rect.x + text_x_offset)
//    .attr("y", rect.y + text_y_offset)
//    .text(rect.name)
//    .attr("fill", rect.textcolor)
//    .style("font-size", "12px")
//    .style("font-family", "Arial")
//    .style("font-weight", "bold")
//    .classed("movable", true); // Add the "movable" class
//
//  // Add a tooltip
//  g.append("description")
//    .text(rect.description);
//}

function drawRectangleNew(x, y, name, color, textcolor, description='') {
  var g = zoomable.append("g");
  
  g.append("rect")
    .attr("x", x)
    .attr("y", y)
    .attr("width", box_width)
    .attr("height", box_height)
    .style("fill", color)
    .classed("movable", true); // Add the "movable" class
  
  g.append("text")
    .attr("x", x + text_x_offset)
    .attr("y", y + text_y_offset)
    .text(name)
    .attr("fill", textcolor)
    .style("font-size", "12px")
    .style("font-family", "Arial")
    .style("font-weight", "bold")
    .classed("movable", true); // Add the "movable" class

  // Add a tooltip
  g.append("description")
    .text(description);
}

function drawColumn(period, data) {
  let filteredData = data.filter(item => item.period === period);
  for (let j = 0; j < data.length; j++) {
    let item = filteredData[j];
    if (item !== undefined) {
      let fullname = `${item.name} (${item.credits})`;
      drawRectangleNew(bin[period], row[j], fullname, item.color, item.textcolor);
    }
  }
}

function drawSchedule(data) {
  // find max 
  var max_period = Math.max(...data.map(item => item.period));
  for (let j = 0; j <= max_period; j++) {
    drawColumn(j, data);
  }
}

function assignBins(max_credits, data) {

  // Initialize an array to keep track of the total credits in each bin
  let binCredits = [0];

  // Initialize an object to keep track of the bin of each course
  let courseBin = {};
  
  // Start at the lowest period and add a course in the first 
  // one that has space
  
  for (let j = 0; j < data.length; j++) {
    let item = data[j];
  
    // Assign bins with prerequisites

    let startBin = 0;

    // if prerequisite line non-empty
    if (item.prerequisite) {
    
      // Split the prerequisites string into an array of prerequisites
      let prerequisites = item.prerequisite.split(' & ');
    
      // Get the bin of each prerequisite
      let prerequisiteBins = prerequisites.map(prerequisite => courseBin[prerequisite]);
    
      // Find the maximum bin among the prerequisites
      let maxPrerequisiteBin = Math.max(...prerequisiteBins);
    
      // Assign the minimum bin
      startBin = maxPrerequisiteBin + 1;    
    } 

    let period = startBin;

    let done = 0;
    while (done === 0) {
      if (binCredits[period] === undefined) {
        binCredits[period] = item.credits;
        done = 1;
      } else if (binCredits[period] + item.credits > max_credits) {
        period++;
      } else {
        binCredits[period] += item.credits;
        done = 1;
      }
    } 
    courseBin[item.name] = period;
    item.period = period;
  }

  //let result = {data, courseBin};
  //return result;
}

function creditSummary(data) {
  // create sum of credits per period

  let summary = data.reduce((acc, item) => {
    // If the period doesn't exist in the accumulator, add it
    if (!acc[item.period]) {
      acc[item.period] = { totalCredits: 0, courseCount: 0 };
    }
  
    // Add the credits for the current item to the period
    acc[item.period].totalCredits += item.credits;
  
    // Increment the course count for the period
    acc[item.period].courseCount++;
  
    return acc;
  }, {});

  return summary;
}

// Define x coordinates for rectangles
var bin = [10];
for (let k=0; k <=30; k++) {
    bin.push(bin[k] + 14 + box_width);
}

// Define y coordinates for rectangles
var y_gap = 4;
var box_space = box_height + y_gap;
var row = [50];
for (let k=0; k <=10; k++) {
    row.push(row[k] + box_space);
}

function redraw(maxc, data) {
  assignBins(maxc, data);
  zoomable.selectAll(".movable").remove();
  drawSchedule(data);
}

// set up default
//redraw(12, data);

// let summary = creditSummary(data);

//console.log(summary.length);
console.log(data);

// Slider
var slider = d3
  .sliderBottom()
  .min(4)
  .max(18)
  .step(1)
  .width(700)
  .default(12)
  .on('onchange', val => {
    redraw(val, data);
  });

var gSlider = d3
  .select('div#slider')
  .append('svg')
  .attr('width', 700)
  .attr('height', 100)
  .append('g')
  .attr('transform', 'translate(30,30)');

gSlider.call(slider);

</script>


<div id="slider"></div>

<input type="checkbox" id="toggleHighlight" name="toggleHighlight">
<label for="toggleHighlight">Highlight prerequisites</label>

