<!DOCTYPE html>
<html>
<head>

  <style>
    body {
      text-align: center;
    }
    
    svg {
      margin-top: 32px;
      border: 1px solid #aaa;
    }
  </style>

  <!-- Load d3.js -->
  <script src='https://d3js.org/d3.v5.js'></script>
</head>

<body>

  <script type="module">
    const data = [
        {
            seq: 1,
            name: "PACE 111B",
            credits: 3,
            color: "green",
            textcolor: "white",
            prerequisite: "",
            period: 1
        },
        {
            seq: 2,
            name: "LIBS 150",
            credits: 1,
            color: "green",
            textcolor: "white",
            prerequisite: "",
            period: 1
        },
        {
            seq: 3,
            name: "WRTG 111",
            credits: 3,
            color: "green",
            textcolor: "white",
            prerequisite: "",
            period: 1
        },
        {
            seq: 4,
            name: "WRTG 112",
            credits: 3,
            color: "green",
            textcolor: "white",
            prerequisite: "",
            period: 2
        },
        {
            seq: 5,
            name: "NUTR 100",
            credits: 3,
            color: "green",
            textcolor: "white",
            prerequisite: "",
            period: 2
        },
        {
            seq: 6,
            name: "BMGT 110",
            credits: 3,
            color: "blue",
            textcolor: "white",
            prerequisite: "",
            period: 2
        },
        {
            seq: 7,
            name: "SPCH 100",
            credits: 3,
            color: "green",
            textcolor: "white",
            prerequisite: "",
            period: 3
        },
        {
            seq: 8,
            name: "STAT 200",
            credits: 3,
            color: "red",
            textcolor: "white",
            prerequisite: "",
            period: 3
        },
        {
            seq: 9,
            name: "IFSM 300",
            credits: 3,
            color: "red",
            textcolor: "white",
            prerequisite: "",
            period: 3
        },
        {
            seq: 10,
            name: "ACCT 220",
            credits: 3,
            color: "blue",
            textcolor: "white",
            prerequisite: "",
            period: 4
        },
        {
            seq: 11,
            name: "HUMN 100",
            credits: 3,
            color: "green",
            textcolor: "white",
            prerequisite: "",
            period: 4
        },
        {
            seq: 12,
            name: "BIOL 103",
            credits: 4,
            color: "green",
            textcolor: "white",
            prerequisite: "",
            period: 5
        },
        {
            seq: 13,
            name: "ECON 201",
            credits: 3,
            color: "red",
            textcolor: "white",
            prerequisite: "",
            period: 4
        },
        {
            seq: 14,
            name: "ARTH 334",
            credits: 3,
            color: "green",
            textcolor: "white",
            prerequisite: "",
            period: 5
        },
        {
            seq: 15,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 6
        },
        {
            seq: 16,
            name: "ECON 203",
            credits: 3,
            color: "red",
            textcolor: "white",
            prerequisite: "",
            period: 6
        },
        {
            seq: 17,
            name: "ACCT 221",
            credits: 3,
            color: "blue",
            textcolor: "white",
            prerequisite: "ACCT 220",
            period: 6
        },
        {
            seq: 18,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 7
        },
        {
            seq: 19,
            name: "BMGT 364",
            credits: 3,
            color: "blue",
            textcolor: "white",
            prerequisite: "",
            period: 7
        },
        {
            seq: 20,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 7
        },
        {
            seq: 21,
            name: "BMGT 365",
            credits: 3,
            color: "blue",
            textcolor: "white",
            prerequisite: "BMGT 364",
            period: 8
        },
        {
            seq: 22,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 8
        },
        {
            seq: 23,
            name: "MRKT 310",
            credits: 3,
            color: "blue",
            textcolor: "white",
            prerequisite: "",
            period: 8
        },
        {
            seq: 24,
            name: "WRTG 394",
            credits: 3,
            color: "green",
            textcolor: "white",
            prerequisite: "WRTG 112",
            period: 9
        },
        {
            seq: 25,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 9
        },
        {
            seq: 26,
            name: "BMGT 380",
            credits: 3,
            color: "blue",
            textcolor: "white",
            prerequisite: "",
            period: 9
        },
        {
            seq: 27,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 10
        },
        {
            seq: 28,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 10
        },
        {
            seq: 29,
            name: "HRMN 300",
            credits: 3,
            color: "blue",
            textcolor: "white",
            prerequisite: "",
            period: 10
        },
        {
            seq: 30,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 11
        },
        {
            seq: 31,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 11
        },
        {
            seq: 32,
            name: "FINC 330",
            credits: 3,
            color: "blue",
            textcolor: "white",
            prerequisite: "ACCT 221 & STAT 200",
            period: 11
        },
        {
            seq: 33,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 12
        },
        {
            seq: 34,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 12
        },
        {
            seq: 35,
            name: "BMGT 496",
            credits: 3,
            color: "blue",
            textcolor: "white",
            prerequisite: "",
            period: 12
        },
        {
            seq: 36,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 13
        },
        {
            seq: 37,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 13
        },
        {
            seq: 38,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 13
        },
        {
            seq: 39,
            name: "ELECTIVE",
            credits: 3,
            color: "yellow",
            textcolor: "black",
            prerequisite: "",
            period: 14
        },
        {
            seq: 40,
            name: "BMGT 495",
            credits: 3,
            color: "blue",
            textcolor: "white",
            prerequisite: "BMGT 365 & MRKT 310 & FINC 330",
            period: 14
        },
        {
            seq: 41,
            name: "CAPSTONE",
            credits: 1,
            color: "yellow",
            textcolor: "black",
            prerequisite: "FINC 330",
            period: 14
        }
      ];

    var transferCredits = false;    

    const screenWidth = 900;
    const boxWidth = 110;
    const boxHeight = 40;
    const textOffsetX = 10; 
    const textOffsetY = 25;
    const sessionOffset = 35;
    const headerRow = 20;

    // Define x coordinates for rectangles
    var bin = [10];
    // if sessions, then 1.75*boxWidth else boxWidth
    for (let k=0; k <=30; k++) {
        bin.push(bin[k] + 20 + 1.75*boxWidth);
    }
    
    // Define y coordinates for rectangles
    const yGap = 4;
    const boxSpace = boxHeight + yGap;
    var row = [80];
    for (let k=0; k <=10; k++) {
        row.push(row[k] + boxSpace);
    }

    var semesterData = [];
    const seasons = ['WINTER', 'SPRING', 'SUMMER', 'FALL'];
    for (let year = 2024; year <= 2040; year++) {
      for (let season of seasons) {
        semesterData.push(`${season} ${year}`);
      }
    }
    
    function render(data) {
      // Start Nested Functions
      function drawColumn(period, data) {
        var filteredData = data.filter(item => item.period === period);
        var anyItem = false;
        for (let j = 0; j < data.length; j++) {
          let offset = (j % 3 - 1) * sessionOffset;
          let item = filteredData[j];
          if (item !== undefined) {
            anyItem = true;
            let fullname = `${item.name} (${item.credits})`;
            drawRectangle(bin[period]+offset, row[j], fullname, item.color, item.textcolor);
          }
        }
        if (anyItem) {
          drawHeader(bin[period], 20, semesterData[period-1], 'lightgray', 'black');
        }
      }
      function drawRectangle(x, y, name, color, textcolor, description='') {
        var g = zoomable.append("g");
        g.append("rect")
          .attr("x", x)
          .attr("y", y)
          .attr("width", boxWidth)
          .attr("height", boxHeight)
          .style("fill", color)
          .classed("movable", true); // Add the "movable" class
        g.append("text")
          .attr("x", x + textOffsetX)
          .attr("y", y + textOffsetY)
          .text(name)
          .attr("fill", textcolor)
          .style("font-size", "12px")
          .style("font-family", "Arial")
          .style("font-weight", "bold")
          .classed("movable", true); // Add the "movable" class
        // Add a tooltip
        g.append("description")
          .text(description);
      }
      function drawHeader(x, y, name, color, textcolor, description='') {
        var g = zoomable.append("g");
        g.append("rect")
          .attr("x", x - sessionOffset)
          .attr("y", y)
          .attr("width", boxWidth + 2 * sessionOffset)
          .attr("height", boxHeight)
          .style("fill", color)
          .classed("movable", true); // Add the "movable" class
        g.append("text")
          .attr("x", x - sessionOffset + 2*textOffsetX)
          .attr("y", y + textOffsetY)
          .text(name)
          .attr("fill", textcolor)
          .style("font-size", "14px")
          .style("font-family", "Arial")
          .style("font-weight", "bold")
          .classed("movable", true); // Add the "movable" class
        // Add a tooltip
        g.append("description")
          .text(description);
      }
      // End of Nested Functions
      zoomable.selectAll(".movable").remove();
      var maxPeriod = Math.max(...data.map(item => item.period));
      for (let j = 0; j <= maxPeriod; j++) {
        drawColumn(j, data);
      }
    }

    // Select the body
    var body = d3.select("body");

    // Zoom behavior
    var svg = body.append('svg')
      .attr('id', 'datavizArea')
      .attr('height', 400)
      .attr('width', 800);
    var zoomable = svg.append("g");
    var zoom = d3.zoom()
      .on("zoom", function() {
        zoomable.attr("transform", d3.event.transform);
      });
    svg.call(zoom);

    render(data);

//    parsedData = JSON.parse(data);
//    render(parsedData);

//    // Load the data from a JSON file
//    d3.json('data.json').then(function(data) {
//      // Use the loaded data
//      render(data);
//    }).catch(function(error) {
//      console.log('Error loading data: ' + error);
//    });
  
  </script>

</body>
</html>
